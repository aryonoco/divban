{
  "name": "divban",
  "build": {
    "dockerfile": "Dockerfile",
    "args": {
      "BUN_VERSION": "1.3.6"
    }
  },

  "features": {
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "installOhMyZsh": false,
      "configureZshAsDefaultShell": true,
      "username": "vscode",
      "userUid": "1000",
      "userGid": "1000",
      "upgradePackages": true
    },
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/jsburckhardt/devcontainer-features/just:1": {}
  },

  "containerUser": "vscode",
  "remoteUser": "vscode",
  "updateRemoteUserUID": true,

  "containerEnv": {
    "BUN_VERSION": "1.3.6",
    "EDITOR": "vim",
    "VISUAL": "vim"
  },

  "mounts": ["source=divban-bun-cache,target=/home/vscode/.bun/install/cache,type=volume"],

  "initializeCommand": "docker volume create divban-bun-cache || true",

  "postCreateCommand": "bash .devcontainer/post-create.sh",

  "runArgs": [
    "--init",
    "--cap-drop=ALL",
    "--cap-add=NET_BIND_SERVICE",
    "--cap-add=DAC_OVERRIDE",
    "--cap-add=SETUID",
    "--cap-add=SETGID",
    "--device=/dev/fuse"
  ],

  "customizations": {
    "vscode": {
      "extensions": [
        "oven.bun-vscode",
        "biomejs.biome",
        "eamodio.gitlens",
        "usernamehw.errorlens",
        "streetsidesoftware.code-spell-checker",
        "tamasfe.even-better-toml",
        "redhat.vscode-yaml",
        "timonwong.shellcheck",
        "foxundermoon.shell-format",
        "github.vscode-github-actions",
        "hangxingliu.vscode-systemd-support",
        "dreamcatcher45.podmanager"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "terminal.integrated.profiles.linux": {
          "zsh": {
            "path": "/bin/zsh"
          }
        },
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "biomejs.biome",
        "editor.tabSize": 2,
        "editor.insertSpaces": true,
        "editor.rulers": [100],
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,
        "files.associations": {
          "*.json": "jsonc",
          "justfile": "just",
          "*.container": "systemd-unit-file",
          "*.network": "systemd-unit-file",
          "*.volume": "systemd-unit-file"
        },
        "[typescript]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[typescriptreact]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[javascript]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[json]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[jsonc]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "typescript.tsdk": "node_modules/typescript/lib",
        "typescript.enablePromptUseWorkspaceTsdk": true,

        "cSpell.language": "en-GB",

        "podmanager.logsOutput": "terminal",
        "podmanager.confirmDeletions": true
      }
    }
  },

  "hostRequirements": {
    "cpus": 2,
    "memory": "4gb",
    "storage": "16gb"
  }
}
