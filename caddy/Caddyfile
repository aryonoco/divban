# Caddy Configuration
# Location: /srv/caddy/Caddyfile

{
	email letsencrypt@qrs.lol
	# acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

# ============================================
# Shared Snippets
# ============================================

(security_headers) {
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
		-Server
		-X-Powered-By
	}
}

# ============================================
# Local Services (this host)
# ============================================

photos.jenkinsameri.com {
	encode zstd gzip
	import security_headers
	reverse_proxy 127.0.0.1:2283
}

budget.jenkinsameri.com {
	encode zstd gzip
	import security_headers
	reverse_proxy 127.0.0.1:5006
}

# ============================================
# Remote Services
# ============================================

speedtest.ameri.me {
	import security_headers
	reverse_proxy librespeed.home.ameri.me:8080
}

plex.ameri.me {
	reverse_proxy plex.home.ameri.me:32400
}

audiobooks.jenkinsameri.com {
	encode zstd gzip
	import security_headers
	reverse_proxy audiobookshelf.home.ameri.me:8080
}

blog.ameri.coffee {
	encode zstd gzip
	import security_headers
	handle /robots.txt {
		root * /webfiles
		file_server
	}
	reverse_proxy writefreely.home.ameri.me:8080
}

notes.ameri.coffee {
	encode zstd gzip
	import security_headers
	handle /robots.txt {
		root * /webfiles
		file_server
	}
	reverse_proxy memos.home.ameri.me:8080
}

files.ameri.coffee {
	import security_headers
	encode zstd gzip
	root * /webfiles/americoffee
	@static {
		file
		path *.ico *.css *.js *.gif *.jpg *.jpeg *.png *.svg *.woff *.woff2 *.html
	}
	handle @static {
		header Cache-Control "public, max-age=2592000"
	}
	file_server {
		precompressed zstd gzip
	}
}
